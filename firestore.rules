rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 用户身份判断
    function isSignedIn() { return request.auth != null; }
    function isOwner(userId) { return isSignedIn() && request.auth.uid == userId; }

    // RPA账号（多条）
    match /accounts/{userId}/jobbox_accounts/{docId} {
      allow read, write: if isOwner(userId);
    }

    // 邮箱设置（单条）
    match /accounts/{userId}/mail_settings/{docId} {
      allow read, write: if isOwner(userId);
    }

    // 目标设置（单条）
    match /accounts/{userId}/target_settings/{docId} {
      allow read, write: if isOwner(userId);
    }

    // 目标分段设置（多条） - 标签保存功能
    match /accounts/{userId}/target_segments/{docId} {
      allow read, write: if isOwner(userId);
    }

    // API设置（单条）
    match /accounts/{userId}/api_settings/{docId} {
      allow read, write: if isOwner(userId);
    }

    // SMS历史记录
    match /accounts/{userId}/sms_history/{docId} {
      allow read, write: if isOwner(userId);
    }

    // 默认拒绝其他路径
    match /{document=**} {
      allow read, write: if false;
    }
  }
}